/*! jquery.dot v0.1.1 | (c) 2016 kamem | https://github.com/kamem/jquery.dot.git */
!function(t,e){"undefined"!=typeof exports?module.exports=e(require("jquery"),t):"function"==typeof define&&define.amd?define(["jquery"],function(){e($,t)}):e($,t)}("undefined"!=typeof window?window:this,function(t,e){!function(){var e,i={},a={},n={};i=function(t){function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}();t.Stage=function(){function t(i){e(this,t),this.$el=i,this.pxWidth=10,this.pxHeight=10,this.width=32,this.height=32,this.canvasWidth=this.width*this.pxWidth,this.canvasHeight=this.height*this.pxHeight,this.layers=[],this.layerNum=-1,this.createNewLayer("#fff"),this.createNewLayer("")}return i(t,[{key:"createNewLayer",value:function(){var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0];this.canvas=this.$el.append('<canvas class="layer"></canvas>').find(".layer"),this.changeLayers({color:t}),this.setLayer({layerNum:this.layerNum})}},{key:"changeStagePxColor",value:function(t){var e=t.pointX,i=t.pointY,a=t.color;this.layers[this.layerNum][i][e]=a}},{key:"getStagePxColor",value:function(t){var e=t.layerNum,i=void 0===e?this.layerNum:e,a=t.pointX,n=t.pointY;return this.layers[i][n][a]}},{key:"changeLayers",value:function(){var t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],e=t.layers,i=t.color;return e?this.layers=e:(this.layerNum+=1,void(this.layers[this.layerNum]=this.createStageAry(i)))}},{key:"clearLayer",value:function(t){this.layers[this.layerNum]=this.createStageAry(t)}},{key:"clearAllLayer",value:function(){var t=this;this.layers.forEach(function(e,i){var a=0===i?"#fff":"";t.layers[i]=t.createStageAry(a)})}},{key:"createStageAry",value:function(){for(var t=arguments.length<=0||void 0===arguments[0]?"":arguments[0],e=[],i=0;i<this.height;i++){e[i]=[];for(var a=0;a<this.width;a++)e[i][a]=t}return e}},{key:"changePxSize",value:function(t){var e=t.pxWidth,i=void 0===e?this.pxWidth:e,a=t.pxHeight,n=void 0===a?this.pxHeight:a;this.pxWidth=i,this.pxHeight=n}},{key:"changeSize",value:function(t){var e=t.width,i=void 0===e?this.width:e,a=t.height,n=void 0===a?this.height:a;this.canvasWidth=i*this.pxWidth,this.canvasHeight=n*this.pxHeight}},{key:"setLayer",value:function(t){var e=t.layerNum;this.layerNum=e,this.canvas[e].width!==this.canvasWidth&&(this.canvas[e].width=this.canvasWidth),this.canvas[e].height!==this.canvasHeight&&(this.canvas[e].height=this.canvasHeight),this.ctx=this.canvas[e].getContext("2d")}},{key:"setG",value:function(t){this.ctx=t}}]),t}();return t}(i),a=function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=navigator.userAgent;e.match(/iPhone OS (\w+){1,3}/g),e.match(/CPU OS (\w+){1,3}/g);var i=(RegExp.$1.replace(/_/g,"")+"00").slice(0,3),a=t.UA={iPhone:e.search(/iPhone/)!==-1,iPad:e.search(/iPad/)!==-1,Android:e.search(/Android/)!==-1&&e.search(/Mobile/)!==-1&&e.search(/SC-01C/)==-1,AndroidTab:e.search(/Android/)!==-1&&(e.search(/Mobile/)==-1||e.search(/SC-01C/)!==-1),Android3_2:e.search(/Android 3.2/)!==-1,iOS5_less:(e.search(/iPhone/)!==-1||e.search(/iPad/)!==-1)&&i<500,other:!(e.search(/iPhone/)!==-1||e.search(/iPad/)!==-1||e.search(/Android/)!==-1&&e.search(/Mobile/)!==-1&&e.search(/SC-01C/)==-1||e.search(/Android/)!==-1&&(e.search(/Mobile/)==-1||e.search(/SC-01C/)!==-1))},n=t.isMobile=a.iPhone||a.iPad||a.Android||a.AndroidTab;t.EVENT_TYPE={touchStart:n?"touchstart":"mousedown",touchEnd:n?"touchend":"mouseup",touchMove:n?"touchmove":"mousemove"};return t}(a),n=function(t,e){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Oekaki=void 0;var a=function(){function t(t,e){var i=[],a=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(a=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);a=!0);}catch(h){n=!0,r=h}finally{try{!a&&s["return"]&&s["return"]()}finally{if(n)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n=function(){function t(t,e){for(var i=0;i<e.length;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,i,a){return i&&t(e.prototype,i),a&&t(e,a),e}}();t.Oekaki=function(){function t(e){var a=e.stage,n=e.strokeStyle,r=e.color,o=void 0===r?"#000":r,s=e.drawingFunction;i(this,t),this.stage=a,this.strokeStyle=n,this.color=o,this.fillStyle=o,this.startX=0,this.startY=0,this.x=0,this.y=0,this.pointX=0,this.pointY=0,this.isDrawing=!1,this.history=[],this.repeatSpeed=10,this.drawingFunction=s}return n(t,[{key:"changeColor",value:function(t){var e=t.color;this.color=e}},{key:"changeFillStyle",value:function(t){var e=t.fillStyle;this.fillStyle=e}},{key:"changeDrawing",value:function(t){this.isDrawing=t}},{key:"changeStartPoint",value:function(t){var e=t.x,i=t.y;this.startX=e,this.startY=i}},{key:"changePoint",value:function(t){var e=t.x,i=t.y;this.x=e,this.y=i}},{key:"changeHistory",value:function(t){this.history=t}},{key:"changeDrawPoint",value:function(){var t=this.getDrawPoint({}),e=t.pointX,i=t.pointY;this.pointX=e,this.pointY=i}},{key:"getDrawPoint",value:function(t){var e=t.x,i=void 0===e?this.x:e,a=t.y,n=void 0===a?this.y:a;return{pointX:Math.floor(i/this.stage.pxWidth),pointY:Math.floor(n/this.stage.pxHeight)}}},{key:"addHistory",value:function(){var t=this.history[this.history.length-1];0!==this.history.length&&t[0]===this.pointX&&t[1]===this.pointY&&t[2]===this.fillStyle||this.history.push([this.stage.layerNum,this.pointX,this.pointY,this.fillStyle])}},{key:"draw",value:function(t){var e=t.pointX,i=void 0===e?this.pointX:e,a=t.pointY,n=void 0===a?this.pointY:a,r=t.fillStyle,o=void 0===r?this.fillStyle:r,s=o?"fillRect":"clearRect";this.stage.ctx.fillStyle=o,this.stage.ctx[s](i*this.stage.pxWidth,n*this.stage.pxHeight,this.stage.pxWidth,this.stage.pxHeight)}},{key:"save",value:function(){var t=deflate(JSON.stringify(this.stage.layers)),e=JSON.stringify(this.history);window.location.search=t,localStorage.draw=e}},{key:"load",value:function(){var t=this,e=arguments.length<=0||void 0===arguments[0]?this.stage.layers:arguments[0];e.forEach(function(e,i){t.stage.setLayer({layerNum:i}),e.forEach(function(e,i){e.forEach(function(e,a){t.draw({pointX:a,pointY:i,fillStyle:e})})})})}},{key:"repeat",value:function(t){var e=this,i=t.speed,n=void 0===i?this.repeatSpeed:i,r=t.history,o=void 0===r?this.history:r;this.clear();for(var s=0,h=0;h<o.length;h++)setTimeout(function(){var t=a(o[s],4),i=t[0],n=t[1],r=t[2],h=t[3];e.stage.setLayer({layerNum:i}),e.draw({pointX:n,pointY:r,fillStyle:h}),s++,e.stage.changeStagePxColor({pointX:n,pointY:r,color:h}),e.drawingFunction&&e.drawingFunction()},n*h)}},{key:"clear",value:function(){this.stage.clearAllLayer(),this.load()}},{key:"setDrawEvent",value:function(){var t=this;this.stage.$el.on(e.EVENT_TYPE.touchStart,function(i){var a=e.isMobile?i.originalEvent.touches[0]:i;t.changeDrawing(!0),t.drawStart({x:a.pageX,y:a.pageY})}).on(e.EVENT_TYPE.touchMove,function(i){if(t.isDrawing){e.isMobile&&event.preventDefault();var a=e.isMobile?i.originalEvent.touches[0]:i;t.drawStart({x:a.pageX,y:a.pageY})}}).on(e.EVENT_TYPE.touchEnd,function(e){t.changeDrawing(!1)}).mouseleave(function(e){t.changeDrawing(!1)})}},{key:"drawStart",value:function(t){var e=t.x,i=t.y;this.changePoint({x:e,y:i}),this.changeStartPoint({x:e,y:i}),this.changeDrawPoint(),this.draw({});var a=this.getDrawPoint({}),n=a.pointX,r=a.pointY;this.stage.changeStagePxColor({pointX:n,pointY:r,color:this.fillStyle}),this.addHistory(),this.drawingFunction&&this.drawingFunction()}}]),t}();return t}(n,a),e=function(e,i){t.fn.dot=function(a){var n=t(this),r=t(".mini"),o=new e.Stage(n),s=new e.Stage(r);s.changePxSize({pxWidth:2,pxHeight:2}),s.changeSize({width:32,height:32});var h=window.location.search.substring(1,window.location.search.length),l=inflate(h);window.location.search&&(o.changeLayers({layers:JSON.parse(decodeURI(l.replace(/%23/g,"#")))}),s.changeLayers({layers:JSON.parse(decodeURI(l.replace(/%23/g,"#")))}));var c=new i.Oekaki({stage:s}),u=new i.Oekaki({stage:o,drawingFunction:function(){s.changeLayers({layers:o.layers}),c.load()}});u.load(),c.load(),u.setDrawEvent(),window.location.search&&u.changeHistory(JSON.parse(localStorage.draw)),t(".save").on("click",function(t){u.save()}),t(".repeat").on("click",function(t){u.changeHistory(JSON.parse(localStorage.draw)),u.repeat({})}),t(".num").on("keyup",function(t){o.setLayer({layerNum:parseInt(t.target.value)}),o.setLayer({layerNum:parseInt(t.target.value)})}),t(".addLayer").on("click",function(e){o.createNewLayer(),t(".num").val(o.layerNum)}),t(".eraser").on("click",function(t){u.changeFillStyle({fillStyle:u.fillStyle?"":u.color})}),t(".color").on("keyup",function(e){console.log(t(".color").val());var i=t(".color").val();u.changeColor({color:i}),u.changeFillStyle({fillStyle:i})})}}(i,n)}()});